/* ================================
   TABLE COMPONENTS
   ================================ */

/* User Management Table Styles */
.user-filter {
    margin-bottom: var(--space-lg);
    padding: var(--space-md);
    background: var(--color-white);
    border-radius: var(--radius-lg);
    border: var(--border-medium) solid var(--color-border-dark);
    box-shadow: var(--shadow-md);
}

.user-filter .form-group {
    max-width: 400px;
}

/* User filter inputs inherit unified styling from forms.css */

/* ================================
   RESIZABLE COLUMNS
   ================================ */

/* Make table columns resizable */
.users-table th,
#patientsTable th {
    position: relative;
    user-select: none; /* Prevent text selection during resizing */
    -webkit-user-select: none; /* Safari */
    -moz-user-select: none; /* Firefox */
    -ms-user-select: none; /* IE 10+ */
    touch-action: none; /* Disable browser handling of touch gestures */
}

/* Resize handle for table columns */
.column-resize-handle {
    position: absolute;
    top: 0;
    right: 0;
    width: var(--resize-handle-width, 5px);
    height: 100%;
    background-color: transparent;
    cursor: col-resize;
    z-index: 10;
    touch-action: none; /* Prevent default touch behavior */
}

.column-resize-handle:hover,
.column-resize-handle.active,
.column-resize-handle:focus {
    background-color: var(--color-primary);
    opacity: 0.5;
    outline: none; /* Remove focus outline, we're using background color instead */
}

/* Improve resize handle visibility on header hover */
.users-table th:hover .column-resize-handle,
#patientsTable th:hover .column-resize-handle {
    background-color: var(--color-primary);
    opacity: 0.3;
}

/* CSS Variables for resize handles */
:root {
    --resize-handle-width: 5px;
    --resize-handle-active-width: 2px;
    --resize-handle-hover-width: 4px;
    --resize-handle-color: var(--color-primary);
    --resize-handle-opacity: 0.5;
    --resize-handle-hover-opacity: 0.5;
    --resize-handle-active-opacity: 0.7;
    --resize-transition-duration: 0.15s;
}

/* Smooth resizing performance optimizations */
.users-table th,
#patientsTable th {
    will-change: auto;
    /* Remove default transition for immediate response during resize */
}

/* During resizing, optimize for performance */
.users-table.resizing th,
#patientsTable.resizing th {
    transition: none;
    will-change: width;
    /* Force hardware acceleration for smooth resizing */
    transform: translateZ(0);
}

/* Add visual indicator when columns are being resized */
.resizing .column-resize-handle.active {
    background-color: var(--resize-handle-color);
    opacity: var(--resize-handle-active-opacity);
    width: var(--resize-handle-active-width);
    box-shadow: 0 0 4px rgba(0, 150, 136, 0.3);
}

/* Show a visual feedback for resizing */
.users-table.resizing,
#patientsTable.resizing {
    user-select: none;
    cursor: col-resize;
}

/* Smooth cursor transition */
.column-resize-handle {
    transition: background-color 0.2s ease, opacity 0.2s ease, width 0.2s ease;
}

/* Focus state for keyboard users */
.column-resize-handle:focus {
    cursor: col-resize;
    background-color: var(--resize-handle-color);
    opacity: 0.8;
    width: var(--resize-handle-hover-width);
    box-shadow: 0 0 0 2px rgba(0, 150, 136, 0.5);
}

/* Show a visual feedback for resizing */
.users-table.resizing,
#patientsTable.resizing {
    cursor: col-resize;
    user-select: none;
}

/* Only highlight the specific column being resized, not all columns */
.column-resize-handle.active {
    background-color: var(--resize-handle-color);
    opacity: var(--resize-handle-active-opacity);
    width: var(--resize-handle-active-width);
}

/* Performance optimizations for smooth resizing */
.users-table.resizing *,
#patientsTable.resizing * {
    pointer-events: none; /* Prevent unwanted hover effects during resize */
}

.users-table.resizing .column-resize-handle,
#patientsTable.resizing .column-resize-handle {
    pointer-events: auto; /* Keep handle interactive */
}

/* Optimize reflow during resizing */
.users-table th,
#patientsTable th,
.users-table td,
#patientsTable td {
    box-sizing: border-box;
}

/* Improve visual feedback during resize */
.users-table.resizing .column-resize-handle.active,
#patientsTable.resizing .column-resize-handle.active {
    background: linear-gradient(
        to bottom,
        var(--resize-handle-color),
        rgba(0, 150, 136, 0.8)
    );
    box-shadow: 0 0 6px rgba(0, 150, 136, 0.4);
    transform: scaleX(1.2);
    transition: transform 0.1s ease;
}

/* Smooth column width changes */
.users-table th:not(.resizing),
#patientsTable th:not(.resizing) {
    transition: width 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Improve cursor feedback */
.users-table.resizing,
#patientsTable.resizing {
    cursor: col-resize !important;
}

.users-table.resizing *,
#patientsTable.resizing * {
    cursor: col-resize !important;
}

/* ================================
   USERS TABLE CONTAINER
   ================================ */

.users-table-container {
    background: var(--color-white);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    overflow: hidden;
    width: 100%;
    position: relative;
    border: var(--border-medium) solid var(--color-border-dark);
}

/* Table Responsive Wrapper */
.table-responsive {
    width: 100%;
    overflow-x: auto;
    overflow-y: visible;
    -webkit-overflow-scrolling: touch;
    margin-bottom: 1rem;
    border-radius: var(--radius-lg);
    scrollbar-width: thin; /* For Firefox */
    scrollbar-color: var(--color-primary) #f1f1f1; /* For Firefox */
}

.table-responsive table {
    margin-bottom: 0; /* Remove bottom margin as the container has it */
}

/* ================================
   USERS TABLE STYLES
   ================================ */

.users-table {
    width: 100%; /* Full width but can expand beyond container */
    border-collapse: collapse;
    font-size: 0.9rem;
    table-layout: auto; /* Auto layout allows content to determine column width */
    display: table;
    min-width: 800px; /* Minimum width for better content display */
}

.users-table thead {
    display: table-header-group;
}

.users-table tbody {
    display: table-row-group;
}

.users-table tr {
    display: table-row;
}

/* Table Headers */
.users-table th {
    background: var(--color-table-header);
    color: var(--color-primary);
    padding: 0.75rem;
    text-align: center;
    font-weight: var(--font-weight-bold);
    border-bottom: var(--border-thick) solid var(--color-secondary);
    border-right: var(--border-thin) solid var(--color-border);
    vertical-align: middle;
    height: 2.5rem;
    display: table-cell;
    white-space: nowrap; /* Prevent text wrapping in headers */
    position: sticky; /* Keep headers visible when scrolling */
    top: 0;
    z-index: 2;
    transition: width 0.1s ease-out; /* Smooth width transitions */
    overflow: hidden; /* Prevent content from overflowing during resize */
}

/* Column widths - min-width instead of fixed width for responsive behavior */
.users-table th:nth-child(1) {
    min-width: 120px;
    width: 15%;
} /* Username */
.users-table th:nth-child(2) {
    min-width: 150px;
    width: 20%;
} /* Full Name */
.users-table th:nth-child(3) {
    min-width: 200px;
    width: 30%;
} /* Email - larger for potentially long emails */
.users-table th:nth-child(4) {
    min-width: 100px;
    width: 15%;
} /* Role */
.users-table th:nth-child(5) {
    min-width: 100px;
} /* Created */
.users-table th:nth-child(6) {
    min-width: 110px;
} /* Actions */

.users-table th:last-child {
    border-right: none;
}

.users-table th:not(.sortable-column) {
    text-align: center;
}

/* Sortable Headers */
.sortable-column {
    cursor: default; /* Default cursor for header, pointer only on sort indicator */
    user-select: none;
    position: relative;
    text-align: center;
    padding-right: 30px; /* Make room for the resize handle */
}

.sortable-column:hover {
    background: #b2dfdb;
}

.sort-indicator {
    margin-left: 0.25rem;
    opacity: 0.5;
    display: inline-block;
    width: 12px;
    cursor: pointer;
    position: relative; /* Changed from absolute to relative */
    padding: 2px; /* Add some padding for better click target */
    border-radius: 2px;
    transition: opacity 0.2s, background-color 0.2s;
    /* Removed absolute positioning to keep it close to text */
}

.sort-indicator:hover {
    opacity: 0.8;
    background-color: rgba(0, 150, 136, 0.1);
}

.sort-indicator::after {
    content: '↕';
    font-size: 0.8rem;
}

.sort-indicator.asc::after {
    content: '↑';
    opacity: 1;
}

.sort-indicator.desc::after {
    content: '↓';
    opacity: 1;
}

/* Table Cells */
.users-table td {
    padding: 0.75rem;
    text-align: center;
    border-bottom: var(--border-thin) solid #f0f0f0;
    border-right: var(--border-thin) solid #f0f0f0;
    vertical-align: middle;
    display: table-cell;
    white-space: nowrap; /* Prevent text from wrapping */
    text-overflow: ellipsis; /* Show ... when text overflows */
    overflow: hidden; /* Hide overflow content */
    max-width: 0; /* Required for text-overflow to work with table cells */
    position: relative; /* For hover effect */
}

/* Specific column behavior */
.users-table td.user-email {
    max-width: none; /* Remove the max-width limit to allow full expansion */
    text-align: left; /* Left-align email text */
    padding-left: 10px; /* Add some left padding */
    position: relative; /* For potential overflow indicator */
}

/* Specific cell styling */
.users-table td.user-created {
    white-space: nowrap; /* Prevent date from wrapping */
}

.users-table td:last-child {
    border-right: none;
}

.users-table tbody tr:hover {
    background-color: #f8fdff;
}

.users-table tbody tr:nth-child(even) {
    background-color: #fafafa;
}

.users-table tbody tr:nth-child(even):hover {
    background-color: #f0f8ff;
}

/* ================================
   TABLE ACTIONS
   ================================ */

.user-actions {
    display: flex;
    gap: 0.75rem;
    justify-content: center;
    align-items: center;
    white-space: nowrap; /* Prevent wrapping of action buttons */
    min-width: 90px; /* Ensure minimum width for the actions column */
}

.role-select {
    /* Inherits unified input styling from forms.css */
    min-width: 120px;
    font-size: 0.85rem;
}

/* Table action buttons */
.btn-edit,
.btn-delete {
    font-size: 16px;
    width: 36px;
    height: 36px;
    box-shadow: var(--shadow-sm);
}

.btn-edit:hover {
    background-color: #e3f2fd;
    border-color: var(--color-primary);
}

.btn-delete:hover {
    background-color: #ffebee;
    border-color: #f44336;
}

/* ================================
   STATUS BADGES
   ================================ */

.status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    font-weight: var(--font-weight-semibold);
    text-transform: uppercase;
}

.status-badge.enabled {
    background-color: #d4edda;
    color: #155724;
    border: var(--border-thin) solid #c3e6cb;
}

.status-badge.disabled {
    background-color: #f8d7da;
    color: #721c24;
    border: var(--border-thin) solid #f5c6cb;
}

.status-badge.error {
    background-color: #fff3cd;
    color: #856404;
    border: var(--border-thin) solid #ffeaa7;
}

/* ================================
   RESPONSIVE TABLE STYLES
   ================================ */

@media screen and (max-width: 767px) {
    .table-responsive {
        -webkit-overflow-scrolling: touch;
        overflow-x: auto;
        overflow-y: hidden;
        display: block;
        width: 100%;
        margin-bottom: 0;
    }

    /* Ensure horizontal scrolling indicators are visible */
    .users-table-container:after {
        content: '→';
        position: absolute;
        right: 10px;
        top: 50%;
        color: var(--color-primary);
        font-size: 20px;
        animation: pulse 1.5s infinite;
        opacity: 0.7;
        pointer-events: none;
    }

    /* Hide the indicator after user scrolls */
    .table-responsive::-webkit-scrollbar {
        height: 6px;
    }

    .table-responsive::-webkit-scrollbar-thumb {
        background: var(--color-primary);
        border-radius: 3px;
    }

    .table-responsive::-webkit-scrollbar-track {
        background: #f1f1f1;
    }

    /* Cell hover effect to show full content on mobile */
    .users-table td:hover {
        white-space: normal;
        overflow: visible;
        max-width: none;
        z-index: 10;
        position: relative;
        background-color: #f8fdff;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
    }

    @keyframes pulse {
        0% {
            opacity: 0.5;
        }
        50% {
            opacity: 1;
        }
        100% {
            opacity: 0.5;
        }
    }
}

@media screen and (max-width: 480px) {
    .users-table th,
    #patientsTable th {
        padding: 0.5rem 0.25rem;
        font-size: 0.85rem;
    }

    .users-table td,
    #patientsTable td {
        padding: 0.5rem 0.25rem;
        font-size: 0.85rem;
    }

    /* Better resize handle targeting on small screens */
    .column-resize-handle {
        width: 8px; /* Wider target for touch */
    }

    .btn-edit,
    .btn-delete {
        width: 32px;
        height: 32px;
        font-size: 14px;
    }

    /* Add visual indicator for horizontally scrollable tables */
    .table-responsive {
        position: relative;
    }

    .table-responsive::after {
        content: '⟷';
        position: absolute;
        right: 10px;
        bottom: -20px;
        font-size: 16px;
        color: var(--color-primary);
        opacity: 0.7;
        animation: pulse 1.5s infinite;
    }
}

/* Very small screens */
@media screen and (max-width: 320px) {
    .users-table th,
    #patientsTable th {
        padding: 0.4rem 0.2rem;
        font-size: 0.8rem;
    }

    .users-table td,
    #patientsTable td {
        padding: 0.4rem 0.2rem;
        font-size: 0.8rem;
    }

    /* Even wider touch targets */
    .column-resize-handle {
        width: 10px;
    }
}
